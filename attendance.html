<!DOCTYPE HTML>
<html>
 <head>
 <title>Attendance</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="shortcut icon" type="image/x-icon" href="AshokaFavicon.png" >
 <style>
	#cast{
	background-color:#ffffff;
	position:fixed;
	bottom:1%;
	right:1%;
	}
	table{
	margin:auto;
	}
 </style>
 <!--CSS FOR MATERIAL CARD-->
 <style>
 .demo-card-reader.mdl-card{
  width:98%;
  height:1vw;
  margin-left:1%;
  margin-top:1%;
  
 }
.demo-card-widee.mdl-card {
  width: 98%;
  margin-left:1%;
  margin-top:2%;
  height:45vw;
}
#divuid{
  width:100%;
  margin-top:0%;
  height:5vw;
  display:block;
  position:fixed;  
  clear:both;
  z-index:10;
  background-color:#ffffff;
}
.mdl-textfield.mdl-js-textfield.uid,.mdl-textfield.mdl-js-textfield.muid{
 display:inline-block;
 margin-left:40%;
}

.material-icons.mdl-list__item-icon.color{
color:rgba(63,81,181,1);
}
</style>
 
 
 
	<link rel="stylesheet" href="./mdl/material.min.css">
	<script src="./mdl/material.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
 <!--above three lines are for material design-->
 </head>
 
 <body onload="document.getElementById('uid').focus();">
 
 
 <!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--no-drawer-button">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">EVENTS ATTENDANCE APP</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
      <!-- Navigation. We hide it in small screens. -->
      <nav class="mdl-navigation mdl-layout--large-screen-only">
		
		<!-- Textfield for event name -->

		
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<input class="mdl-textfield__input" type="text" id="eventname_visible">
			<label class="mdl-textfield__label" for="eventname_visible" style="color:#ffffff;">Event Name</label>
			</div>
		

		
	   <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect" onclick="download();">
	   DOWNLOAD
	   </button>
	   
      </nav>
    </div>
  </header>
  <main class="mdl-layout__content">
    <div class="page-content">
	<!-- Your content goes here -->
	<div id="divuid" class="mdl-shadow--2dp uid">
	
				
				<!-- Simple Textfield-->
				<div class="mdl-textfield mdl-js-textfield uid" id="focustext">
				<!--for HID reader-->
				<input class="mdl-textfield__input" type="text" id='uid' oninput="check(this)">
				<label class="mdl-textfield__label" style="color:rgba(63,81,181,1)" for="uid" id="uid_label">&nbsp; HID MODE ACTIVATED </label>
				
				<!--for manual attendance-->
				<input class="mdl-textfield__input" type="text" id='muid' onkeydown="manual(event)" style="display:none;">
				<label class="mdl-textfield__label" style="color:rgba(63,81,181,1);display:none;" for="muid" id="muid_label">&nbsp; MANUAL MODE ACTIVATED </label>
				</div>
				
				<!-- Primary-colored flat button -->
				<button class="mdl-button mdl-js-button mdl-button--accent" style="float:right;display:inline-block;margin-top:1%;margin-right:2%;" id="manualuid" onclick="toggleid();">
				MANUAL ATTENDANCE
				</button>
	
	</div>
	<br><br>
	<!--CARD FOR INSTRUCTIONS-->
	<div class="demo-card-widee mdl-card mdl-shadow--2dp">
		<div class="mdl-card__title mdl-card--expand">
			<h2 class="mdl-card__title-text">About the app</h2>
		</div>
		<div class="mdl-card__supporting-text">
			Events Attendance App is intended to take attendance using HID cards. However, it also supports attendance through typing the name.
		</div>
	
	
		<div class="mdl-card__title mdl-card--expand">
			<h2 class="mdl-card__title-text">Instructions</h2>
		</div>
		<div class="mdl-card__supporting-text">
			<ul style="list-style-type:none;" class="demo-list-icon mdl-list">
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						To take manual attendance, click Manual Attendance, type in the name and hit enter.
					</span>
				</li> 
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						 For using HID reader follow the steps mentioned below.
					</span>
				</li>
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						Make sure the device is connected to the reader.
					</span>
				</li>
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						Attach HID card reader (to be issued from reception, ground floor, Ashoka University)
					</span>	
				</li>
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
					Make sure cursor is focused on 'HID' textbox
					</span>
				</li>
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						Ask students to touch their cards on the card reader and wait till their name appears on screen
					</span>	
				</li>
				<li class="mdl-list__item">
					<span class="mdl-list__item-primary-content">
					 <i class="material-icons mdl-list__item-icon color">album</i>
						Add the Name of the event and download the file.
					</span>	
				</li>
			</ul>
		</div>
	</div>
	
	
	<br>
	<table class="mdl-data-table mdl-js-data-table  mdl-shadow--2dp">
  <thead>
    
	<tr>
      <th class="mdl-data-table__cell--non-numeric">Name</th>
      <th>Time</th>
      
    </tr>
  </thead>
  <tbody id="list">
    
  </tbody>
</table>

	<!--Hidden form to submit all the data to server-->
	<form hidden method="post" action="download.php" id='hiddenform'>
	<input name='eventname' id='eventname' >
	</form>
	
	<div id='cast'>
	Developed by Paras Bhattrai
	</div>
	
	
	<!-- Your content END-->
	</div>
  </main>
</div>
 
 
 
 
 
	
 </body>
 <script>
 
 //test 
 //bee67001fbff12e0
  //var names=document.getElementById('names');
  var tbody=document.getElementById('list');
  var variable; //as parameter in check()
  var variable1; //as parameter in manual()
  var xhr=null;
  //for using to make form submitting name and time for download to attendance.php
  var fname=1,ftime=1;
  //var scroll=0;
  var uid;
  var toggle=1;//for switching between manual and hid attendance mode. Toggles textbox
  function check(variable){
    if(variable.value.length==16 || variable.id=="muid")//read either from HID textfield(uid) or Manual textfield(muid)
	{
		uid=variable.value;
		//alert(variable.value);
		document.getElementById('uid').value='';
		try{
		 xhr=new XMLHttpRequest();
		}
		catch(e){
		 xhr=new ActiveXObject("Microsoft.XMLHTTP");
		}
		if(xhr==null)
		alert("Unable to run program. Connection Issue (Ajax request)");
		
		var url="attendance.php?uid="+uid;
		xhr.onreadystatechange=handler;
		xhr.open("GET",url,true);
		xhr.send(null);
		
	}	
	
  }
  function handler(){
   if(xhr.readyState==4){
		if(xhr.status==200){
			var response=eval("("+ xhr.responseText +")");
			//var p=document.createElement('p');
			
			var td=document.createElement('td');
			td.className="mdl-data-table__cell--non-numeric";
			var tr=document.createElement('tr');
			var td1=document.createElement('td');
			var formname=document.createElement('input');
			formname.name='n'+fname;
			var formtime=document.createElement('input');
			formtime.name='t'+fname;
			fname++;ftime++;
			
			if(response.name=='')
			{
				//to display data in the current page, if no data is received for a person
				td.style.color="red";
				td.innerHTML=uid;
				td1.innerHTML=response.hour+":"+response.min;
				
				//to prepare form input fields
				formname.value=uid;
				formtime.value=response.hour+":"+response.min;
			}	
			else
				{
				
				//to display data in current page, if person exists in db
				td.innerHTML=response.name; //cell containing name
				td1.innerHTML=response.hour+":"+response.min; //cell containing timestamp
				
				//to prepare form input fields
				formname.value=response.name;
				formtime.value=response.hour+":"+response.min;
 				}
			tbody.appendChild(tr);
			tbody.lastChild.appendChild(td); //last row of the table, appending name element
			tbody.lastChild.appendChild(td1); //last row of the table, appending name element
			
			//scroll to bottom
			tbody.lastChild.scrollIntoView(); //last row of the table, appending name element
			
			//to append data in hidden form for transfer to server--
			document.getElementById('hiddenform').appendChild(formname);
			document.getElementById('hiddenform').appendChild(formtime);
			//names.appendChild(p);
			//scroll++;
			//alert(response.name);
			//if(scroll==8)
			//document.getElementById('uid').style.position="fixed";
		}
   }
  }
 
	function download(){
	document.getElementById('eventname').value=document.getElementById('eventname_visible').value;
	document.getElementById('hiddenform').submit();
	
	}
	
	//to toggle between manual and HID attendendance mode
	function toggleid(){
		if(toggle==1)
		{
			//switch to manual mode
			document.getElementById('muid').style.display="inline-block";
			document.getElementById('muid').value="";
			document.getElementById('muid_label').style.display="inline-block";
			document.getElementById('uid').style.display="none";
			document.getElementById('uid_label').style.display="none";
			
			//mdl focus loses when dom elements are changed dynamically
			//to preserve the focus effect, isFocused class is to be added to the parent element, which is done below
			document.getElementById('focustext').className="mdl-textfield mdl-js-textfield uid is-upgraded is-focused";
			
			document.getElementById('muid').focus();
			//changing name of the button to toggle back
			document.getElementById('manualuid').innerHTML="HID ATTENDANCE";
			toggle=0;	
		}
		else
		{
			//switch to hid mode
			document.getElementById('uid').style.display="inline-block";
			document.getElementById('uid').value="";
			document.getElementById('uid_label').style.display="inline-block";
			document.getElementById('muid').style.display="none";
			document.getElementById('muid_label').style.display="none";
			
			document.getElementById('uid').focus();
			
			//changing name of the button to toggle back
			document.getElementById('manualuid').innerHTML="MANUAL ATTENDANCE";
			toggle=1;
		}
	}
	
	function manual(variable1){
		//to clear label (wasn't happening on its own)
		document.getElementById('muid_label').style.display="none";
		
		if(variable1.which==13) //if enter is pressed then append the name in the list
		{ 
			check(document.getElementById('muid'));
		}
	}
 </script>
</html>